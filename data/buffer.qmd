---
title: Testing more efficient distance calculation
format:
  html:
    embed-resources: true
---

```{r}
library(terra)

devtools::load_all("../model")

config <- load_config()
feature_mappings <- get_feature_mappings(config)

aoi <- vect("Shapefiles/Bush/Bush.shp")
aoi <- vect("Shapefiles/BenVorlich/BenVorlich.shp")
#aoi <- vect("Shapefiles/Clackmann/Clackmann.shp")
aoi <- vect("Legacy/Legacy_Data/input/Raw_Shapefile/CairngormNP/CairngormNP.shp")
```

```{r}
path <- "Stage_2/FIPS_I/FIPS_I_NationalCycleNetwork.tif"
path <- "Stage_2/FIPS_I/FIPS_I_LocalPathNetwork.tif"
raster <- rast(path) |> crop(aoi)

unique(values(raster))

plot(raster)

buf <- buffer(raster, width = 500)
plot(buf)

raster <- ifel(is.na(raster), 0, raster)
plot(raster)

raster <- mask(raster, buf, maskvalues=FALSE, updatevalue=NA)
plot(raster)

#dist <- distance(raster)
dist <- distance(raster, target=0, exclude = NA)
plot(dist)
```

